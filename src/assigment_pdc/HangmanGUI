import javax.swing.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

/**
 * The HangmanGUI class represents the graphical user interface for the Hangman game.
 * It extends JFrame to create a window for the game.
 */

public class HangmanGUI extends JFrame {
    private GameManager gameManager;
    private JTextField usernameField;
    private JTextField levelField;
    private JTextField guessField;
    private JTextArea gameArea;
    private User currentUser;
    private Game currentGame;

//Constructs the HangmanGUI and initializes the GUI components.
public HangmanGUI() {
        gameManager = new GameManager();
        initialize();
    }

//Initializes the GUI components and sets up the layout and event listeners.
private void initialize() {
        setTitle("Hangman Game");
        setSize(500, 420);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLayout(null);

        // Username label and text field
        JLabel usernameLabel = new JLabel("Username:");
        usernameLabel.setBounds(50, 20, 80, 25);
        add(usernameLabel);

        usernameField = new JTextField();
        usernameField.setBounds(150, 20, 165, 25);
        add(usernameField);

        // Level label and text field
        JLabel levelLabel = new JLabel("Level:");
        levelLabel.setBounds(50, 60, 80, 25);
        add(levelLabel);

        levelField = new JTextField();
        levelField.setBounds(150, 60, 165, 25);
        add(levelField);

        // Start game button
        JButton startButton = new JButton("Start Game");
        startButton.setBounds(150, 100, 150, 25);
        add(startButton);

        // Start game button action listener
        startButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                startGame();
            }
        });

        // Guess label and text field
        JLabel guessLabel = new JLabel("Enter Guess:");
        guessLabel.setBounds(50, 140, 80, 25);
        add(guessLabel);

        guessField = new JTextField();
        guessField.setBounds(150, 140, 50, 25);
        add(guessField);

        // Guess button
        JButton guessButton = new JButton("Guess");
        guessButton.setBounds(210, 140, 100, 25);
        add(guessButton);

        // Guess button action listener
        guessButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                makeGuess();
            }
        });

        
        // Quit button
        JButton quitButton = new JButton("Quit");
        quitButton.setBounds(320, 140, 100, 25); 
        add(quitButton);

        // Quit button action listener
        quitButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                System.exit(0); 
            }
        });

        
        // Game area text area
        gameArea = new JTextArea();
        gameArea.setBounds(50, 180, 300, 150);
        gameArea.setEditable(false);
        add(gameArea);

        setVisible(true);
    }

//Starts a new game using the provided username and level.
private void startGame() {
        String username = usernameField.getText();
        int level = Integer.parseInt(levelField.getText());
        currentUser = new User(username);
        gameManager.addUser(currentUser);
        gameManager.startGame(currentUser, level);
        currentGame = gameManager.getCurrentGame(currentUser);
        updateGameArea();
    }

//Processes a user's guess and updates the game area.
private void makeGuess() {
        if (currentGame == null) {
            return;
        }
        String guessText = guessField.getText();
        if (guessText.length() != 1) {
            return; // Invalid input, we expect a single character
        }
        char guess = guessText.charAt(0);
        currentGame.playGame(guess);
        updateGameArea();
    }

//Updates the game area to reflect the current state of the game.
private void updateGameArea() {
        if (currentGame == null) {
            return;
        }
        StringBuilder gameText = new StringBuilder();
        gameText.append("Word: ").append(currentGame.getDisplayWord()).append("\n");
        gameText.append("Incorrect Guesses: ").append(currentGame.getIncorrectGuesses()).append("\n");
        gameText.append("Remaining Attempts: ").append(currentGame.getRemainingAttempts()).append("\n");
        if (currentGame.isGameOver()) {
            gameText.append("Game Over! The word was: ").append(currentGame.getSecretWord()).append("\n");
        } else if (currentGame.isWordGuessed()) {
            gameText.append("Congratulations! You guessed the word!\n");
        }
        gameArea.setText(gameText.toString());
    }
}
